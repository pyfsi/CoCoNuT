# Tests

## Idea

Unit tests are particularly important to developers to debug their code separately from other coupling components. These 
unit tests also offer an opportunity to quickly check whether or not the installation of the package was successful, as mentioned 
on the [start page](../README.md#quick-test). 

The remainder of this documentation page focuses on running these tests. The first section explains the procedure to run
(almost) all tests at once, which is useful for the post-installation test. The second section contains information on how to 
include the unit test of a solver wrapper in the testing framework. Finally, it is explained how to run a single test file,
test class or test method. The latter is useful in the development of a new solver wrappers to quickly test a single 
aspect of the wrapper without having to test all aspects together, which can be time consuming. 

## Running unit tests

### Running unit tests
The unit tests in CoCoNuT uses the unittest module available in Python. 
To run the default collection of tests which evaluates in a matter of seconds, navigate to the _`coconut/tests/`_ directory 
and type following command in the terminal:
````
python run_test.py
````
This command will run all tests excluding the solver wrapper tests that are not pure Python.
These tests are excluded because they each take several minutes to complete.
The above command is equivalent to 
````
python run_test.py -fast
````
It is equally possible to run all test by using the keyword `-all` as follows
````
python run_test.py -all
````
Besides these two predefined keywords, it is also possible to use (a set of) arbitrary keywords.
For example
````
python run_test.py fluent abaqus
````
will run all tests that have the `fluent` or `abaqus` in its path: e.g.
`coconut.tests.solver_wrappers.test_v2019R1.test_move_nodes`.

Besides the method of running tests explained above, it is also possible to use commands of the form
````
python -m unittest -bv
````
Here, the keyword `discover` is assumed silently and all unit tests in modules named `test*.py`_ will be looked for.
It will recursively find all the test files with this pattern for all the folders containing an _`__init__.py`_ file. 
The `-b` keyword suppresses any output generated by the part of the code that is being tested, unless an error occurs or a test fails. 
Finally, the `-v` keyword enables a higher verbosity, as such the user can see what test methods have been run. Further documentation 
on the Python unit test framework can be found on the [Python documentation website](https://docs.python.org/3/library/unittest.html).

### Running a specific unit test separately
The Python unit test framework allows for running the test separately as well. This is particularly useful for the unit tests
of the solver wrappers, as they generally take a bit longer to run. There are two possibilities: running a test 
on the level of a file, or on the level of the class or even a method. While in many cases it is not required,
it is sometimes needed to start the test from the _`coconut/tests/`_ directory! 
If not, errors will occur due to erroneous paths, especially in the tests of a solver wrapper.

Let us consider the Abaqus unit test as an example. It is located in _`coconut/tests/solver_wrappers/abaqus/test_v614.py`_. In this file
there are two test classes: `TestSolverWrapperAbaqus614Tube2D` and `TestSolverWrapperAbaqus614Tube3D`, which inherit from the former.
Within these test classes, four test methods are run: `test_repeat_iteration`, `test_restart`, `test_partitioning` and 
`test_shear`. The other two methods, `setUpClass` and `setUp`, are run just before each test class and test method, respectively.

If one wants to test this entire file, type following command in the terminal:

````
python -m unittest -bv solver_wrappers/abaqus/test_v614.py
````
 
 This will run both test classes and all four test methods for each test class. The `-b` and `-v` keywords have the same meaning 
 as above. If one wants to test for example only the 2D test class, type the following command in the terminal:
 
````
python -m unittest -bv solver_wrappers.abaqus.test_v614.TestSolverWrapperAbaqus614Tube2D
````

Note the `.` instead of the `/` to separate the folders since now classes are considered rather than files. This command 
will cause Python to run all four test methods from the 2D test class. Finally, it is also possible to run a single 
test method as well. Consider one wants to test only the correct partitioning of the Abaqus solver over multiple cores 
in the 3D test class, type following command in the terminal:

````
python -m unittest -bv solver_wrappers.abaqus.test_v614.TestSolverWrapperAbaqus614Tube3D.test_partitioning
````

Here, only the test method `test_partitioning` is run in the `TestSolverWrapperAbaqus614Tube3D` class.

### What if solver software is not available
If a solver wrapper test is run, but the software is not available, the test will automatically be skipped and the non-availability wil be given
as the reason.
The availability of software is checked using the _`solver_modules.py`_ file.