file set-batch-options n y n
(enable-dynamic-mesh-node-ids #t)
;file start "transcript_setup.txt"
file read-case mesh_cond_test_1.msh
grid check
grid modify-zones zone-type 2 fluid

define user-defined compiled-functions compile "mass_source" yes ./mass_source.c "" ""
define user-defined compiled-functions load "mass_source"
define user-defined user-defined-memory 2
define user-defined function-hooks initialization "init_volumes::mass_source" ""

define models unsteady-1st-order y
define models viscous laminar y
define models solver pressure-based y
define models energy y n n n y
define models solidification-melting? yes , , ,
solve set equations flow n

define materials copy fluid air pcm
define materials change-create pcm , yes constant 870 yes constant 2500 yes constant 2.4 yes constant 0.004 no yes 8.61e-4 y 179000 y 299.15 y 299.16 n

define boundary-conditions fluid , y pcm y 1 n y "udf_mass_source::mass_source" 0 0 0 n n n , n , n y n
define boundary-conditions wall adiabatic 0 n 0 n n n 0 y motion-bc-stationary n n 0 n ,
;Outer wall is adiabatic as well
define boundary-conditions wall wall 0 n 0 n n n 0 y motion-bc-stationary n n 0 n ,
define boundary-conditions wall boundary 0 n 0 n n n 0 y motion-bc-stationary n n 0 n ,

;define operating-conditions operating-pressure 0
define operating-conditions gravity n

solve monitors residual check-convergence y
solve monitors residual convergence-criteria 1.0E-10

solve set discretization-scheme temperature 0
solve set gradient-scheme n y
;solve set under-relaxation temperature 0.3

;solve set reporting-interval 10
;solve set flow-warnings n

;Initialise solid at solidus temp.
solve initialize set-defaults temperature 293.15
solve initialize initialize-flow

;create iso-surface at liquidus temp. in setup file
surface iso-surface temperature isothermal () 2 () 299.16 ()
plot plot y "isothermal_x_timestep0" n n n x-coordinate n y n isothermal ()
plot file "isothermal_x_timestep0"
plot plot y "isothermal_y_timestep0" n n n y-coordinate n y n isothermal ()
plot file "isothermal_y_timestep0"

file write-case-data pc_solid.cas.h5
exit
