file set-batch-options n y n
(enable-dynamic-mesh-node-ids #t)
;file start "transcript_setup.txt"
file read-case mesh_forced_conv_test_2.msh
grid check
grid modify-zones zone-type 2 fluid

define models unsteady-1st-order y
define models viscous laminar y
define models solver pressure-based y
define models energy y n n n y
solve set equations flow y

define materials copy fluid air pcm
define materials change-create pcm , yes boussinesq 780 yes constant 2500 yes constant 1.5 yes constant 0.004 no yes 8.61e-4 no

define boundary-conditions fluid , y pcm n n n n , n , n y n
define boundary-conditions velocity-inlet inlet n n y y n 0.005 n 0 n 283.15
define boundary-conditions pressure-outlet outlet y n 0 n 283.15 n y y n n
define boundary-conditions wall wall 0 n 0 n y temperature n 283.15 n y shear-bc-spec-shear n 0 n 0 n ,
define boundary-conditions wall boundary 0 n 0 n y heat-flux n 0 n n n ,

;define operating-conditions operating-pressure 0
define operating-conditions gravity n

solve monitors residual check-convergence y y y y
solve monitors residual convergence-criteria 1.0E-3 1.0E-3 1.0E-3 1.0E-6

solve set discretization-scheme temperature 0
solve set discretization-scheme mom 1
solve set discretization-scheme pressure 12
solve set p-v-coupling 20
solve set gradient-scheme n y
;solve set reporting-interval 10
;solve set flow-warnings n

solve report-definitions add avg-temp volume-average
field temperature
zone-names 2 ,
per-zone? no
q

solve report-definitions add itf-flux surface-areaavg
field heat-flux
surface-names boundary ,
per-surface? no
q

solve report-definitions add wall-flux surface-areaavg
field heat-flux
surface-names wall ,
per-surface? no
q

define named-expressions add "outflow_integral"
definition "AreaAve(Density*SpecificHeatCapacity,['outlet'])*AreaInt(StaticTemperature*Velocity.y,['outlet'])"
q

solve report-definitions add outlet-integral single-val-expression
define "outflow_integral"
q

solve report-files add report-file
report-defs avg-temp itf-flux wall-flux outlet-integral flow-time ,
file-name "./report-file.out"
active? yes
q

solve initialize set-defaults temperature 283.15
solve initialize set-defaults pressure 0
solve initialize set-defaults x-velocity 0
solve initialize set-defaults y-velocity 0
solve initialize initialize-flow

file write-case-data cht_fluid.cas.h5
exit
